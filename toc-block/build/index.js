(()=>{"use strict";const e=window.React,t=window.wp.blocks,o=window.wp.blockEditor,c=window.wp.components,n=window.wp.element;(0,t.registerBlockType)("toc-block/inner-toc",{title:"Inner Table of Contents",icon:"list-view",category:"widgets",attributes:{tocItems:{type:"array",default:[]}},edit({attributes:t,setAttributes:r}){const l=(0,o.useBlockProps)(),[a,s]=(0,n.useState)(t.tocItems||[]);return(0,n.useEffect)(()=>{const e=document.querySelector(".block-editor-writing-flow");if(!e)return;const o=document.querySelector(`[data-block="${l["data-block"]}"]`);let c=o?o.closest("section"):null;c||(c=e);const n=e=>(e||"").toLowerCase().replace(/\s+/g," ").trim(),a=()=>{const e=Array.from(c.querySelectorAll("h2")),o={};(t.tocItems||[]).forEach(e=>{o[n(e.text)]=e});const l=e.map(e=>{const t=e.innerText||e.textContent||"",c=function(e){let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");return t.length>30&&(t=t.substring(0,30).replace(/-+$/g,""),t+="..."),t}(t),r=o[n(t)];return{text:t,anchor:c,customLabel:r?r.customLabel:"",ignore:!!r&&!!r.ignore}});s(l);const a=t.tocItems||[];a.length===l.length&&a.every((e,t)=>e.text===l[t].text&&e.anchor===l[t].anchor&&e.customLabel===l[t].customLabel&&e.ignore===l[t].ignore)||r({tocItems:l})};a();const i=new window.MutationObserver(()=>{a()});return i.observe(e,{childList:!0,subtree:!0,characterData:!0}),()=>i.disconnect()},[t.tocItems]),(0,e.createElement)("div",{...l},(0,e.createElement)(o.InspectorControls,null,(0,e.createElement)(c.PanelBody,{title:"Customize TOC Labels & Visibility"},(t.tocItems||[]).map((o,n)=>(0,e.createElement)("div",{key:o.anchor,style:{marginBottom:"1em"}},(0,e.createElement)(c.TextControl,{label:`Label for: ${o.text}`,value:o.customLabel||"",onChange:e=>((e,o)=>{const c=(t.tocItems||[]).map(t=>t.anchor===e?{...t,customLabel:o}:t);r({tocItems:c})})(o.anchor,e),placeholder:o.text}),(0,e.createElement)("label",{style:{display:"block",marginTop:"0.3em"}},(0,e.createElement)("input",{type:"checkbox",checked:!!o.ignore,onChange:e=>((e,o)=>{const c=(t.tocItems||[]).map(t=>t.anchor===e?{...t,ignore:o}:t);r({tocItems:c})})(o.anchor,e.target.checked)})," ","Ignore this H2 in TOC ",(0,e.createElement)("span",{style:{color:"#666",fontStyle:"italic"}},"(",o.text,")")))))),(0,e.createElement)("nav",{className:"toc-block-inner-toc"},(0,e.createElement)("ul",null,(t.tocItems||[]).filter(e=>{if(e.ignore)return!1;const t=(""!==e.customLabel?e.customLabel:e.text).trim(),o=(e.anchor||"").trim();return""!==t&&""!==o}).map((t,o)=>(0,e.createElement)("li",{key:t.anchor},(0,e.createElement)("a",{href:`#${t.anchor}`},t.customLabel||t.text))))))},save:()=>null})})();